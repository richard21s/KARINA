<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AI Mortgage Simulation - Home</title>
  <link
    href="https://fonts.googleapis.com/css2?family=Lato:wght@400;600&family=Poppins:wght@300;400;500;600&display=swap"
    rel="stylesheet" />
  <link rel="stylesheet" href="home.css" />
  <link rel="stylesheet" href="layout.css" />
</head>

<body>
  <!-- Sidebar & Header dimuat otomatis -->
  <div id="sidebar-placeholder"></div>
  <div id="header-placeholder"></div>
  
  <div class="blur blur-left"></div>
  <div class="blur blur-right"></div>


  <!-- ✅ Konten utama -->
  <div class="container">
    <div class="main-content">
      <!-- Hero Section -->
      <section class="hero">
        <h1>Welcome back to</h1>
        <h1>the AI Mortgage Simulation.</h1>
        <div class="welcome">Hello, Anonimous</div>
        <div class="tagline">“Start a new simulation or continue from your last analysis history.”</div>
      </section>

      <div class="blur2 blur-left2"></div>
      <div class="blur2 blur-right2"></div>

      <!-- Last Analysis -->
      <!-- <section>
        <h2 class="section-title">Your Last Mortgage Analysis</h2>
        <div style="display: flex; justify-content: center; margin-top: 20px;">
          <button class="check-btn">Check It</button>
        </div>
        <img class="history-img" src="https://placehold.co/735x466" alt="Simulation Result" />
      </section> -->

      <section>
        <h2 class="section-title">Your Last Mortgage Analysis</h2>
        <div style="display: flex; justify-content: center; margin-top: 20px;">
          <button class="check-btn" onclick="location.href='analysis-detail.html'">Check It</button>
        </div>
        <div id="chartContainer">
          <canvas id="lastAnalysisChart"></canvas>
        </div>
      </section>


      <div class="blur3 blur-left3"></div>
      <div class="blur3 blur-right3"></div>

      <!-- Quick Actions -->
      <section>
        <h2 class="section-title">Quick Actions</h2>
        <div class="quick-actions">
          <div class="action-card">
            <h3>AI Mortgage Simulation</h3>
            <p>Try new loan scenarios with AI analysis results</p>
            <button class="check-btn" onclick="location.href='analisis.html'">Get Started</button>
          </div>
          <div class="action-card">
            <h3>History</h3>
            <p>Browse previous simulations</p>
            <button class="check-btn" onclick="location.href='history.html'">History</button>
          </div>
          <div class="action-card">
            <h3>Calendar</h3>
            <p>Set up a repayment schedule</p>
            <button class="check-btn" onclick="location.href='calendar.html'">See Calendar</button>
          </div>
        </div>
      </section>

      <!-- Footer -->
      <footer class="footer">
        <div class="footer-columns">
          <div class="footer-column">
            <div class="logo" style="letter-spacing: 10px; font-size: 20px; margin-top: 28px;">KARINA</div>
          </div>
          <div class="footer-column">
            <h4>Quick links</h4>
            <ul>
              <li>Home</li>
              <li>Features</li>
              <li>Community</li>
              <li>Support</li>
            </ul>
          </div>
          <div class="footer-column">
            <h4>Help</h4>
            <ul>
              <li>Help Centre</li>
              <li>FAQ</li>
              <li>Forum</li>
            </ul>
          </div>
          <div class="footer-column">
            <h4>Social Media</h4>
            <ul>
              <li>Facebook</li>
              <li>Instagram</li>
              <li>LinkedIn</li>
            </ul>
          </div>
          <div class="footer-mailing">
            <h4>Join our mailing list for updates</h4>
            <input type="email" placeholder="Your email address" />
          </div>
        </div>
        <div class="footer-bottom">© 2025. All rights reserved.</div>
      </footer>
    </div>
  </div>

  <!-- ✅ Script
  <script type="module" src="main.js"></script> -->
  <!-- ✅ Script -->
  <script type="module">
    import { loadComponents } from "./main.js";
    loadComponents(); // ini sudah otomatis muat sidebar, header, & update user info
  </script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      // const lastChartData = JSON.parse(localStorage.getItem("lastChartData"));
      const principal = localStorage.getItem("principal");
      const email = localStorage.getItem("googleEmail");

      let userKey = null;
      if (principal) {
        userKey = `lastChartData_${principal}`;
      } else if (email) {
        userKey = `lastChartData_${email}`;
      }

      let lastChartData = null;
      if (userKey) {
        lastChartData = JSON.parse(localStorage.getItem(userKey));
      }



      if (lastChartData) {
        const ctx = document.getElementById("lastAnalysisChart").getContext("2d");
        new Chart(ctx, {
          type: "line",
          data: {
            labels: lastChartData.months,
            datasets: [
              {
                label: "Pokok",
                data: lastChartData.pokok,
                borderColor: "rgba(75, 192, 192, 1)",
                backgroundColor: "rgba(75, 192, 192, 0.2)",
                fill: true,
                tension: 0.3
              },
              {
                label: "Bunga",
                data: lastChartData.bunga,
                borderColor: "rgba(255, 99, 132, 1)",
                backgroundColor: "rgba(255, 99, 132, 0.2)",
                fill: true,
                tension: 0.3
              },
              {
                label: "Penalti",
                data: lastChartData.penaltiVals,
                borderColor: "rgba(255, 206, 86, 1)",
                backgroundColor: "rgba(255, 206, 86, 0.2)",
                fill: true,
                tension: 0.3
              }
            ]
          },
          options: {
            responsive: true,
            plugins: {
              legend: { display: true },
              tooltip: { enabled: true }
            },
            scales: {
              x: { title: { display: true, text: "Bulan" } },
              y: { title: { display: true, text: "Rp" } }
            }
          }
        });
      } else {
        document.getElementById("lastAnalysisChart").outerHTML =
          "<p style='text-align:center;margin-top:20px;'>There is no analysis yet. Run a simulation first on the AI Mortgage Simulation.</p>";
      }
    });
  </script>


  </script>

</body>

</html>